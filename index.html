<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Harga Cetakan 3D</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

  body {
    font-family: 'Poppins', sans-serif;
    background: #f0f4f8;
    margin: 0;
    padding: 2rem;
    color: #1e293b;
  }

  h1, h2 { text-align: center; color: #0f172a; }
  .container {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    justify-content: center;
  }

  .card {
    background: #fff;
    padding: 1.8rem;
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    max-width: 400px;
    flex: 1 1 350px;
  }

  label { display: block; margin-top: 1rem; font-weight: 600; }
  input[type="text"], input[type="number"], select {
    width: 100%;
    padding: 8px 10px;
    margin-top: 4px;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    font-size: 1rem;
  }

  .input-with-unit { position: relative; }
  .input-with-unit span {
    position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
    color: #64748b; font-weight: 600;
  }
  button {
    background: #2563eb; color: #fff; border: none;
    padding: 10px 20px; font-size: 1rem; border-radius: 10px;
    cursor: pointer; margin-top: 1rem; width: 100%;
    transition: background 0.3s;
  }
  button:hover { background: #1e40af; }
  .result { background: #f1f5f9; padding: 1rem; margin-top: 1.5rem; border-radius: 10px; }
  ul { margin: 0.5rem 0 0 1rem; padding: 0; list-style: none; }
  .bundar { color: #0f766e; font-weight: bold; margin-left: 8px; }
  .item-flex { display:flex; justify-content:space-between; align-items:center; }
  .item-flex button { width: auto; padding: 2px 8px; background:#ef4444; margin:0; font-size:0.85rem; border-radius:5px; }
  .addons, .manage-section { margin-top: 1rem; background: #f9fafb; padding: 0.8rem; border-radius: 8px; border: 1px solid #e2e8f0; }
  .addons label, .manage-section label { display: flex; align-items: center; font-weight: 500; gap: 8px; cursor: pointer; margin: 6px 0; }
</style>
</head>
<body>

<h1>Kalkulator Harga Cetakan 3D</h1>

<div class="container">

  <!-- Pengurusan Filament & Tambahan -->
  <div class="card manage-section">
    <h2>âš™ï¸ Pengurusan Filament & Tambahan</h2>

    <label>Jenis Filament Baru:</label>
    <input type="text" id="filamentBaru" placeholder="Contoh: TPU">

    <label>Harga Filament (RM / 1000g):</label>
    <input type="number" id="hargaBaru" step="0.01">

    <button onclick="tambahFilament()">Tambah / Kemas Kini Filament</button>

    <h3>ğŸ“Œ Senarai Harga Filament:</h3>
    <ul id="senaraiFilament"></ul>

    <h3>ğŸ“Œ Kemaskini Harga Tambahan:</h3>
    <label>ğŸª¶ Kemasan (RM): <input type="number" id="hargaKemasan" step="0.01" value="0.20"></label>
    <label>ğŸ¨ Cat (RM): <input type="number" id="hargaCat" step="0.01" value="1.00"></label>
    <label>ğŸªµ Sanding (Figura) (RM): <input type="number" id="hargaSandingFigura" step="0.01" value="0.20"></label>
    <label>ğŸªµ Sanding (Part) (RM): <input type="number" id="hargaSandingPart" step="0.01" value="0.10"></label>
  </div>

  <!-- Kalkulator -->
  <div class="card">
    <label>âš™ï¸ Jenis Cetakan:</label>
    <select id="jenisCetakan">
      <option value="figura">ğŸ§â€â™‚ï¸ Figura</option>
      <option value="part">âš™ï¸ Part / Komponen</option>
    </select>

    <label>âš–ï¸ Berat Objek:</label>
    <div class="input-with-unit">
      <input type="number" id="berat" placeholder="Contoh: 105.27" step="0.01">
      <span>g</span>
    </div>

    <label>ğŸ§µ Jenis Filament:</label>
    <select id="filament" onchange="setHargaAuto()"></select>

    <label>ğŸ’° Harga Filament (RM / 1000g):</label>
    <input type="number" id="harga" step="0.01">

    <label>â±ï¸ Tempoh Cetakan:</label>
    <div style="display:flex; gap:10px;">
      <input type="number" id="jam" placeholder="Jam">
      <input type="number" id="minit" placeholder="Minit">
    </div>

    <div class="addons">
      <strong>ğŸ§© Tambahan (Premium Sahaja):</strong>
      <label><input type="checkbox" id="kemasan"> ğŸª¶ Kemasan</label>
      <label><input type="checkbox" id="cat"> ğŸ¨ Cat</label>
      <label><input type="checkbox" id="sanding"> ğŸªµ Sanding</label>
    </div>

    <button id="kiraBtn" onclick="kira()">Kira Harga</button>

    <div class="result" id="hasil">
      <p>Masukkan data untuk kira harga.</p>
    </div>
  </div>

</div>

<script>
  const hargaDefault = { pla: 45.90, petg: 49.90, abs: 59.90 };
  const margin = { standard: 0.70, premium: 1.20 };

  function kemaskiniDropdown() {
    const select = document.getElementById("filament");
    select.innerHTML = "";
    const senarai = document.getElementById("senaraiFilament");
    senarai.innerHTML = "";
    for (const key in hargaDefault) {
      // Dropdown
      const option = document.createElement("option");
      option.value = key;
      option.textContent = key.toUpperCase();
      select.appendChild(option);

      // Senarai dengan butang Delete
      const li = document.createElement("li");
      const div = document.createElement("div");
      div.className = "item-flex";
      div.innerHTML = `<span>${key.toUpperCase()}: RM${hargaDefault[key].toFixed(2)}</span>`;
      const btn = document.createElement("button");
      btn.textContent = "Delete";
      btn.onclick = () => { delete hargaDefault[key]; kemaskiniDropdown(); };
      div.appendChild(btn);
      li.appendChild(div);
      senarai.appendChild(li);
    }
    setHargaAuto();
  }

  function tambahFilament() {
    const nama = document.getElementById("filamentBaru").value.trim().toLowerCase();
    const harga = parseFloat(document.getElementById("hargaBaru").value);
    if (!nama || isNaN(harga)) { alert("Sila masukkan nama filament & harga dengan betul!"); return; }
    hargaDefault[nama] = harga;
    kemaskiniDropdown();
    document.getElementById("filamentBaru").value = "";
    document.getElementById("hargaBaru").value = "";
  }

  function setHargaAuto() {
    const jenis = document.getElementById("filament").value;
    document.getElementById("harga").value = hargaDefault[jenis] || 0;
  }

  function formatMasa(jam, minit) {
    let teks = "";
    if (jam>0) teks+=`${jam} jam `;
    if (minit>0) teks+=`${minit} minit`;
    return teks.trim() || "0 minit";
  }

  function kira() {
    const berat = parseFloat(document.getElementById("berat").value);
    const hargaFilament = parseFloat(document.getElementById("harga").value);
    const jam = parseFloat(document.getElementById("jam").value)||0;
    const minit = parseFloat(document.getElementById("minit").value)||0;
    const jenisCetakan = document.getElementById("jenisCetakan").value;
    if(isNaN(berat)||isNaN(hargaFilament)){document.getElementById("hasil").innerHTML="<p>âš ï¸ Sila isi berat & harga dengan betul!</p>"; return;}
    const totalJam = jam + (minit/60);
    const masaTeks = formatMasa(jam,minit);
    const kosFilament = berat*(hargaFilament/1000);
    const kosElektrik = totalJam*0.25;
    const kosSebenar = kosFilament + kosElektrik;

    let kosPremiumExtra = 0; let senaraiPremium=[];
    const hargaKemasan=parseFloat(document.getElementById("hargaKemasan").value)||0;
    const hargaCat=parseFloat(document.getElementById("hargaCat").value)||0;
    const hargaSandingFigura=parseFloat(document.getElementById("hargaSandingFigura").value)||0;
    const hargaSandingPart=parseFloat(document.getElementById("hargaSandingPart").value)||0;

    if(document.getElementById("kemasan").checked){kosPremiumExtra+=hargaKemasan; senaraiPremium.push(`Kemasan (+RM${hargaKemasan.toFixed(2)})`);}
    if(document.getElementById("cat").checked){kosPremiumExtra+=hargaCat; senaraiPremium.push(`Cat (+RM${hargaCat.toFixed(2)})`);}
    if(document.getElementById("sanding").checked){
      const sandingHarga=(jenisCetakan==="figura")? hargaSandingFigura: hargaSandingPart;
      kosPremiumExtra+=sandingHarga;
      senaraiPremium.push(`Sanding (+RM${sandingHarga.toFixed(2)})`);
    }

    const hargaMin=Math.ceil(kosSebenar+1).toFixed(2);
    const hargaStd=kosSebenar*(1+margin.standard);
    const hargaPrem=kosSebenar*(1+margin.premium)+kosPremiumExtra;
    const hargaStdBundar=Math.ceil(hargaStd).toFixed(2);
    const hargaPremBundar=Math.ceil(hargaPrem).toFixed(2);
    const tambahanText=senaraiPremium.length>0? senaraiPremium.join(", "):"Tiada tambahan";

    document.getElementById("hasil").innerHTML=`
      <h3>ğŸ“Š Ringkasan Kiraan:</h3>
      <p>ğŸ§© Jenis Cetakan: <b>${jenisCetakan==="figura"?"Figura":"Part / Komponen"}</b></p>
      <p>ğŸ’¡ Kos Filament: RM ${kosFilament.toFixed(2)}</p>
      <p>âš¡ Kos Waktu (${masaTeks} Ã— RM0.25/jam): RM ${kosElektrik.toFixed(2)}</p>
      <p>ğŸ”¹ Jumlah Kos Sebenar: <b>RM ${kosSebenar.toFixed(2)}</b></p>
      <hr>
      <h3>ğŸ’° Anggaran Harga Jual:</h3>
      <p>ğŸŸ¢ Minimum (Kos+RM1): <b>RM ${hargaMin}</b></p>
      <p>ğŸ”µ Standard (+70%): <b>RM ${hargaStd.toFixed(2)}</b> <span class="bundar">â†’ RM ${hargaStdBundar}</span></p>
      <p>ğŸŸ£ Premium (+120% + tambahan): <b>RM ${hargaPrem.toFixed(2)}</b> <span class="bundar">â†’ RM ${hargaPremBundar}</span></p>
      <p>ğŸ¨ Tambahan Premium: ${tambahanText}</p>`;
  }

  if(!/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){
    document.addEventListener("keypress", e=>{
      if(e.key==="Enter"){ e.preventDefault(); document.getElementById("kiraBtn").click(); }
    });
  }

  window.onload=kemaskiniDropdown;
</script>

</body>
</html>
